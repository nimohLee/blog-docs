지금 회사에서 프로젝트로 자바, 스프링 기반의 웹 솔루션을 개발하고 있다. (사실 거의 SI 프로젝트다)

이 프로젝트는 CI/CD같은 파이프라인이 구축되지 않고, 시간에 쫓기느라 그런 걸 할 시간도 없다. 만약 하는 게 어떠냐고 제안하면 욕먹을 게 뻔했다.. (물론 아직 1년도 안 된 신입이기 때문에 제안도 못 해봤지만..)

우리끼리 '개발서버'라고 부르는 사내 리눅스 서버(aws)가 있는데, 각자가 개발한 내용을 빌드해서 테스트해보는 용도로 사용하고 있다. 즉, Git에 커밋된 코드를 자동 배포하는 게 아니라 개발자 로컬에 있는 코드를 배포하는 것이다.
좋은 환경에서 개발하는 분들은 "왜 저렇게 개발하지?" 하며 이 과정자체를 이해하지 못할 수도 있다.

## 기존 빌드 및 배포 과정
기존에 하던 빌드하고 배포하는 방식은 매우 간단하지만, 은근히 귀찮은 일이었다. 
1. 현재 프로젝트를 빌드한다.
2. 프로젝트/target/ 에 생성되는 jar 스냅샷 파일을 개발서버에 수동으로 업로드한다.
 (윈도우에서 개발 중이기 때문에 mobaXtrem과 같은 툴로 드래그 앤 드랍을 했다.)
 3. 기존에 실행되던 jar 파일의 이름에 현재 날짜와 시간을 붙여 백업 폴더로 이동시킨다.
 4. 새로 업로드된 jar파일의 이름을 jar 실행 쉘 스크립트에 지정된 실행 파일명에 맞게 변경한다.
 5. 정지 쉘 스크립트를 실행 후, 시작 쉘 스크립트를 실행한다.

뭔가 수정한 뒤 리눅스에서 테스트를 해보기 위해서는 항상 이 과정을 거쳐야했다. 심지어 내게 출근할 때마다 해당 작업을 수행하라는 지시가 내려왔다.

프로젝트가 하나면 모르겠는데 5개나 된다. 사실, 몇 개월동안 내가 이 작업을 하지 않고 내가 테스트할 것만 수동 빌드, 배포했기 때문에 크게 불편함을 느끼지 못했다. 하지만 매일 5번의 똑같은 빌드, 업로드, 이름 변경, 폴더 이동, 정지와 시작을 한다는 것은 참 귀찮은 일이었다.

그래서 한 번 귀찮고 앞으로 편하자는 생각으로 난생 처음 빌드 및 배포 자동화 쉘 스크립트를 작성해보았다.

## 자동화된 빌드 및 배포 과정
이제 매우 간단하다. 그냥 쉘 스크립트를 실행하면 빌드, 업로드, 이름 및 폴더 변경, java 프로세스 재시작을 할 수 있다. 쉘 스크립트를 실행하기만 하면 더 이상 내가 할 것은 없다. 이렇게 간단한 것을 왜 이제서야 했나싶다.

### 어떻게 했나?
앞서 말한대로, 나는 쉘 스크립트를 한 번도 짜본 적이 없기때문에 많은 구글링이 필요했다. 게다가, 회사 로컬 개발환경이 윈도우이기 때문에 Windows PowerShell을 사용해야 했다. 리눅스와 개행이 다르고 문법도 달라서 꽤 애먹었다.
> 역시 개발은 Mac으로.... 제발 Mac으로 개발하게 해주세요 ㅜ

#### 연결
사내 개발서버(aws)에 우리는 이미 SSH 연결을 할 수 있었다. 때문에 연결하는 데에는 크게 어려움이 없었다. 빌드한 파일을 업로드 하는 데에는 `SCP(Secure Copy Protocol)`을 사용했다. `SFTP(Secure File Transfer Protocol)`이 아닌 `SCP`를 사용한 것은 단순 파일 복사를 위한 스크립팅이기 때문이다. 서버 간 파일 전송 시에 SFTP가 SCP 보다 좀 더 Best Practice라고 하지만, 파일만 업로드하면 되는 나의 경우에는 SCP가 좀 더 단순하고 스크립팅 하기 좋았다.

아래는 SFTP와 SCP의 파일 업로드 방식이다.
- SFTP
```bash
sftp -oPort=50022 $REMOTE_USER@$REMOTE_FTP_ADDR << EOF
cd $REMOTE_UPLOAD_PATH
lcd $LOCAL_PATH
put $FILE_NAME
quit
EOF
```

- SCP
```bash
scp -p 50022 $LOCAL_PATH/$FILE_NAME $REMOTE_USER@$REMOTE_FTP_ADDR:$REMOTE_UPLOAD_PATH
```

내가 느끼기에는 업로드만을 위해서는 `SCP` 쪽이 더 간단하고 직관적이었다.

#### 실수
처음 스크립트를 실행할 때, Connect Refused로 고생했다. 분명 로컬에서 ssh로 잘만 접속했는데 갑자기 안 되서 뭐가 문제인가 싶었다.
바보같이 포트를 놓쳤다.. `scp`를 사용할 때 포트를 지정해주지 않으면 자동으로 `ssh` 기본 포트인 22로 간다. 사내 개발서버의 `ssh` 포트는 실제로 22가 아니었다.

## 나가며
내가 귀찮아서 해야할 일을 빠르게 끝내고 간단한 스크립트를 작성했다. 왜 진작 안 했는 지 모를 정도로 간단하고 효율적이었다. 또, 동료들에게 해당 파일들과 사용방법을 나눠주고 나니 뭔가 도움이 된 듯한 느낌이 들어 좋았다. 내 힘으로 팀원에게 좀 더 도움을 줄 수 있는 실력있는 개발자가 되기위해 노력해야겠다.

